# Example Nginx snippet for shieldstack.dev/upload
server {
    server_name shieldstack.dev;
    root /var/www/html;

    location /upload/ {
        # Serve the PHP app
        index index.php;
        try_files $uri $uri/ /upload/index.php?$args;
    }

    location ~ ^/upload/.+\.php$ {
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_pass unix:/run/php-fpm/www.sock;
    }

    # Expose uploaded files as static content
    location /upload/uploads/ {
        autoindex off;
        add_header Cache-Control "public, max-age=604800";
        try_files $uri =404;
    }

    # Allow mobile uploads up to 12MB to cover the PHP 10MB limit with headroom
    client_max_body_size 12m;
}
